<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê²°ì œ - ìì—°ì¹˜ìœ ê´€ê´‘ í¬ëŸ¼</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <h1>ìì—°ì¹˜ìœ ê´€ê´‘ í¬ëŸ¼</h1>
                <p>Natural Healing Tourism Forum</p>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">í™ˆ</a></li>
                    <li><a href="seminars.html">ì„¸ë¯¸ë‚˜</a></li>
                    <li><a href="courses.html">ê°•ì¢Œ</a></li>
                    <li><a href="dashboard.html">ë‚´ ê°•ì˜ì‹¤</a></li>
                    <li><a href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <div class="form-container" style="max-width: 600px;">
                <h2 style="text-align: center; color: #2d5016; margin-bottom: 2rem;">ê°•ì¢Œ ê²°ì œ</h2>
                
                <div class="alert alert-info" style="margin-bottom: 2rem;">
                    <strong>ğŸ’¡ ì•ˆë‚´</strong><br>
                    í˜„ì¬ ê²°ì œ ì‹œìŠ¤í…œì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤. 4ë‹¨ê³„ì—ì„œ í† ìŠ¤í˜ì´ë¨¼ì¸  ë˜ëŠ” ì¹´ì¹´ì˜¤í˜ì´ ì—°ë™ì„ ì§„í–‰í•  ì˜ˆì •ì…ë‹ˆë‹¤.
                </div>
                
                <!-- ê²°ì œ ì •ë³´ -->
                <div class="card" style="margin-bottom: 2rem;">
                    <h3 style="color: #2d5016; margin-bottom: 1rem;">ì£¼ë¬¸ ì •ë³´</h3>
                    <div id="orderInfo" style="display: grid; gap: 0.8rem; color: #666;">
                        <div style="display: flex; justify-content: space-between;">
                            <strong>ê°•ì¢Œëª…:</strong>
                            <span id="courseName">-</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <strong>ìˆ˜ê°•ë£Œ:</strong>
                            <span id="coursePrice" style="font-size: 1.2rem; color: #4a7c2c; font-weight: 700;">-</span>
                        </div>
                        <div style="padding-top: 1rem; border-top: 2px solid #2d5016; display: flex; justify-content: space-between;">
                            <strong style="font-size: 1.1rem;">ê²°ì œ ê¸ˆì•¡:</strong>
                            <span id="totalPrice" style="font-size: 1.3rem; color: #2d5016; font-weight: 700;">-</span>
                        </div>
                    </div>
                </div>
                
                <!-- ê²°ì œ ë°©ë²• ì„ íƒ -->
                <div class="card" style="margin-bottom: 2rem;">
                    <h3 style="color: #2d5016; margin-bottom: 1rem;">ê²°ì œ ë°©ë²•</h3>
                    <div style="display: grid; gap: 1rem;">
                        <label style="display: flex; align-items: center; padding: 1rem; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer;">
                            <input type="radio" name="payment" value="card" checked style="margin-right: 1rem;">
                            <div>
                                <strong>ì‹ ìš©ì¹´ë“œ</strong>
                                <div style="font-size: 0.9rem; color: #666;">ëª¨ë“  ì¹´ë“œì‚¬ ì§€ì›</div>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 1rem; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer;">
                            <input type="radio" name="payment" value="kakaopay" style="margin-right: 1rem;">
                            <div>
                                <strong>ì¹´ì¹´ì˜¤í˜ì´</strong>
                                <div style="font-size: 0.9rem; color: #666;">ê°„í¸ ê²°ì œ</div>
                            </div>
                        </label>
                        
                        <label style="display: flex; align-items: center; padding: 1rem; border: 2px solid #e0e0e0; border-radius: 8px; cursor: pointer;">
                            <input type="radio" name="payment" value="transfer" style="margin-right: 1rem;">
                            <div>
                                <strong>ê³„ì¢Œì´ì²´</strong>
                                <div style="font-size: 0.9rem; color: #666;">ì‹¤ì‹œê°„ ê³„ì¢Œì´ì²´</div>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- ì•½ê´€ ë™ì˜ -->
                <div style="margin: 1.5rem 0; padding: 1rem; background: #f8f9fa; border-radius: 5px;">
                    <label style="display: flex; align-items: start; cursor: pointer;">
                        <input type="checkbox" id="agreeTerms" required style="margin-top: 0.2rem; margin-right: 0.5rem;">
                        <span style="font-size: 0.9rem; color: #555;">
                            ê²°ì œ ì§„í–‰ì— ë™ì˜í•˜ë©°, í™˜ë¶ˆ ì •ì±…ì„ í™•ì¸í•˜ì˜€ìŠµë‹ˆë‹¤. (í•„ìˆ˜)
                        </span>
                    </label>
                </div>
                
                <button onclick="processPayment()" class="btn" style="width: 100%; font-size: 1.1rem;">
                    ê²°ì œí•˜ê¸°
                </button>
                
                <div style="text-align: center; margin-top: 1rem;">
                    <a href="courses.html" style="color: #666; text-decoration: none;">ì·¨ì†Œ</a>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2024 ìì—°ì¹˜ìœ ê´€ê´‘ í¬ëŸ¼ (Natural Healing Tourism Forum). All rights reserved.</p>
        </div>
    </footer>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // ë¡œê·¸ì¸ ì²´í¬
        if (!requireLogin()) {
            // ì´ë¯¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¨
        }
        
        // URL íŒŒë¼ë¯¸í„°ì—ì„œ ê°•ì¢Œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const urlParams = new URLSearchParams(window.location.search);
        const courseId = urlParams.get('course_id');
        const amount = urlParams.get('amount');
        
        if (!courseId || !amount) {
            alert('ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.');
            window.location.href = 'courses.html';
        }
        
        // ì£¼ë¬¸ ì •ë³´ í‘œì‹œ (ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°•ì¢Œ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì•¼ í•¨)
        document.getElementById('courseName').textContent = 'ê°•ì¢Œëª… ë¡œë”© ì¤‘...';
        document.getElementById('coursePrice').textContent = 'â‚©' + Number(amount).toLocaleString();
        document.getElementById('totalPrice').textContent = 'â‚©' + Number(amount).toLocaleString();
        
        // ê²°ì œ ì²˜ë¦¬ (4ë‹¨ê³„ì—ì„œ ì‹¤ì œ ê²°ì œ API ì—°ë™ ì˜ˆì •)
        function processPayment() {
            const agreeTerms = document.getElementById('agreeTerms').checked;
            
            if (!agreeTerms) {
                alert('ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
            
            alert('ê²°ì œ ì‹œìŠ¤í…œì€ 4ë‹¨ê³„ì—ì„œ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.\n\ní˜„ì¬ëŠ” ë°ëª¨ ëª¨ë“œë¡œ, ìˆ˜ê°• ì‹ ì²­ë§Œ ì§„í–‰ë©ë‹ˆë‹¤.');
            
            // ì„ì‹œ: ë¬´ë£Œ ìˆ˜ê°• ì‹ ì²­ìœ¼ë¡œ ì²˜ë¦¬
            enrollCourseAfterPayment(courseId);
        }
        
        // ê²°ì œ ì™„ë£Œ í›„ ìˆ˜ê°• ì‹ ì²­
        async function enrollCourseAfterPayment(courseId) {
            const user = checkLogin();
            
            showLoading(true);
            
            try {
                await fetch(CONFIG.APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'enrollCourse',
                        user_email: user.email,
                        course_id: courseId,
                        payment_status: 'completed',
                        payment_amount: amount
                    })
                });
                
                showLoading(false);
                alert('ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\nìˆ˜ê°• ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = 'dashboard.html';
                
            } catch (error) {
                showLoading(false);
                console.error('ìˆ˜ê°• ì‹ ì²­ ì˜¤ë¥˜:', error);
                alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>
</html>
